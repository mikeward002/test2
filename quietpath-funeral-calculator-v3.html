<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QuietPath • Funeral Cost Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;600;700&family=Raleway:wght@600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #fcfbf9;
      --fg: #1a1a1a;
      --subtle:#6b7280;
      --dusty-blue:#5a7da3;
      --muted-plum:#6e608c;
      --warm-sand:#e8dcc8;
      --border:#e5e7eb;
      --white:#ffffff;
      --focus:#ffbf47;
    }
    html, body{ margin:0; padding:0; background:var(--bg); color:var(--fg); font-family:Lato,system-ui; line-height:1.6; font-size:16px; }
    .container{ max-width:1000px; margin:0 auto; padding:24px 18px 64px; }
    h1{ font-family:Raleway, Lato, sans-serif; font-weight:800; font-size:clamp(1.6rem,3vw,2.2rem); color:var(--dusty-blue); margin:4px 0 10px; }
    .lede{ color:var(--subtle); }
    .intro-card{ background:var(--warm-sand); border:1px solid var(--border); border-radius:16px; padding:18px; }
    .intro-card h2{ font-family:Raleway, Lato, sans-serif; font-size:1.05rem; color:var(--muted-plum); margin:0 0 8px; }
    .notice{ background:#fff; border:1px solid var(--border); border-radius:12px; padding:12px 14px; margin-top:10px; }
    .cta-row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .btn{ appearance:none; border:1px solid var(--dusty-blue); background:var(--dusty-blue); color:#fff; border-radius:999px; padding:10px 14px; font-size:1rem; cursor:pointer; }
    .btn.secondary{ background:transparent; color:var(--dusty-blue); }
    .btn:focus{ outline:3px solid var(--focus); outline-offset:2px; }
    .card{ background:#fff; border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.03); margin-top:16px; }
    .section-title{ font-family:Raleway, Lato, sans-serif; color:var(--muted-plum); font-size:1.15rem; margin:0 0 8px; }
    .controls .row{ display:flex; align-items:center; gap:10px; padding:10px 0; border-bottom:1px dashed var(--border); }
    .controls .row:last-child{ border-bottom:none; }
    select{ font-size:1rem; padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:#fff; color:var(--fg); }
    .scenario-toggle{ display:flex; gap:8px; flex-wrap:wrap; }
    .pill-toggle{ border:1px solid var(--border); background:#fff; padding:8px 12px; border-radius:999px; cursor:pointer; }
    .pill-toggle[aria-pressed="true"]{ border-color:var(--dusty-blue); box-shadow:inset 0 0 0 1px var(--dusty-blue); color:var(--dusty-blue); font-weight:700; }
    .totals .grand{ font-weight:800; font-size:1.35rem; border-top:2px solid var(--border); padding-top:10px; color:var(--dusty-blue); }
    table{ width:100%; border-collapse:collapse; }
    thead th{ text-align:left; padding:10px; background:#f7f7f8; border-bottom:1px solid var(--border); }
    tbody td{ border-bottom:1px solid var(--border); padding:10px; vertical-align:middle; }
    .right{ text-align:right; }
    .row-actions{ display:flex; gap:10px; justify-content:flex-end; font-size:.95rem; }
    .link{ color:var(--dusty-blue); text-decoration:underline; background:none; border:none; padding:0; cursor:pointer; font:inherit; }
    .muted{ color:#9aa0a6; }
    .amount-view{ font-variant-numeric:tabular-nums; font-weight:700; }
    .amount-edit{ display:none; }
    .amount-input{ width:140px; padding:8px 10px; border:1px solid var(--border); border-radius:10px; font-size:1rem; text-align:right; }
    .footer-actions{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; margin-top:16px; }
    @media print{ .intro-card .cta-row, #controlsSection .section-title, #btnShowItems, .footer-actions{ display:none !important; } body{ background:#fff; } .card{ box-shadow:none; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Funeral Cost Calculator</h1>
      <p class="lede">A starting point to see typical costs, without pressure to decide everything right now.</p>
      <div class="intro-card">
        <h2>How this works</h2>
        <div>This sample uses a traditional burial with a service, with cemetery costs included. Review the total first, then open the options to adjust details for your needs and location.</div>
        <div class="notice"><strong>Note:</strong> These estimates use national averages from the National Funeral Directors Association and other public sources. Actual costs vary by provider and region.</div>
        <div class="cta-row">
          <button class="btn" id="btnShowItems">Show itemized costs</button>
          <button class="btn secondary" id="btnShowOptions">Quick options</button>
        </div>
      </div>
    </header>

    <section class="card" aria-labelledby="totalsTitle">
      <h2 id="totalsTitle" class="section-title">Your Estimate</h2>
      <div class="totals" aria-live="polite" aria-atomic="true">
        <div class="total-line"><span>Items Subtotal</span><span id="subtotal" class="amount-view">$0</span></div>
        <div class="total-line"><span>State Multiplier</span><span id="multiplier">×1.00</span></div>
        <div class="total-line grand"><span>Total Estimate</span><span id="grand" class="amount-view">$0</span></div>
        <div class="total-line"><span class="muted">Scenario</span><span id="scenarioBadge">Traditional burial, cemetery on</span></div>
      </div>
    </section>

    <section id="controlsSection" class="card" style="display:none;" aria-labelledby="scenarioTitle">
      <h2 id="scenarioTitle" class="section-title">Options</h2>
      <div class="controls">
        <div class="row" aria-live="polite">
          <label class="muted" id="scenarioLabel">Service type</label>
          <div class="scenario-toggle" role="group" aria-labelledby="scenarioLabel">
            <button class="pill-toggle" id="btn-burial" aria-pressed="true">Traditional burial</button>
            <button class="pill-toggle" id="btn-cremation" aria-pressed="false">Traditional cremation</button>
          </div>
        </div>
        <div class="row">
          <label class="muted">Cemetery costs</label>
          <div class="scenario-toggle">
            <button class="pill-toggle" id="btn-cemetery-on" aria-pressed="true">On</button>
            <button class="pill-toggle" id="btn-cemetery-off" aria-pressed="false">Off</button>
          </div>
        </div>
        <div class="row">
          <label for="stateSelect" class="muted">State</label>
          <select id="stateSelect"></select>
          <span class="muted">Applies a broad regional cost factor.</span>
        </div>
      </div>
    </section>

    <section id="itemsSection" class="card" style="display:none;" aria-labelledby="itemsTitle">
      <h2 id="itemsTitle" class="section-title">Itemized Costs</h2>

      <div class="group" id="grpFuneral">
        <h3>Funeral home services</h3>
        <table><thead><tr><th>Item</th><th class="right">Amount</th><th class="right">Actions</th></tr></thead>
          <tbody id="bodyFuneral"></tbody>
        </table>
      </div>
      <div class="group" id="grpTransport">
        <h3>Transportation</h3>
        <table><thead><tr><th>Item</th><th class="right">Amount</th><th class="right">Actions</th></tr></thead>
          <tbody id="bodyTransport"></tbody>
        </table>
      </div>
      <div class="group" id="grpCeremony">
        <h3>Viewing and ceremony</h3>
        <table><thead><tr><th>Item</th><th class="right">Amount</th><th class="right">Actions</th></tr></thead>
          <tbody id="bodyCeremony"></tbody>
        </table>
      </div>
      <div class="group" id="grpBurial">
        <h3>Burial and cemetery</h3>
        <table><thead><tr><th>Item</th><th class="right">Amount</th><th class="right">Actions</th></tr></thead>
          <tbody id="bodyBurial"></tbody>
        </table>
      </div>
      <div class="group" id="grpCremation">
        <h3>Cremation</h3>
        <table><thead><tr><th>Item</th><th class="right">Amount</th><th class="right">Actions</th></tr></thead>
          <tbody id="bodyCremation"></tbody>
        </table>
      </div>

      <div class="footer-actions">
        <button class="btn secondary" id="btnPrint">Print / Save as PDF</button>
        <button class="btn" id="btnCSV">Download CSV</button>
      </div>
    </section>
  </div>

  <script>
    // --- State multipliers ---
    const STATE_MULTIPLIERS = {
      "California":1.2,"New York":1.2,"Massachusetts":1.2,"Connecticut":1.2,"New Jersey":1.2,
      "District of Columbia":1.2,"Washington":1.2,"Oregon":1.2,"Hawaii":1.2,"Alaska":1.2,"Maryland":1.2,
      "Alabama":0.8,"Arkansas":0.8,"Mississippi":0.8,"Oklahoma":0.8,"Kentucky":0.8,"West Virginia":0.8,
      "Louisiana":0.8,"Tennessee":0.8,"Missouri":0.8,"New Mexico":0.8,"South Carolina":0.8,"Idaho":0.8
    };
    const ALL_STATES = ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];

    const ITEMS = [
      { id:'basic_services', label:'Basic services of funeral director and staff', base:2300, group:'funeral', appliesTo:'both' },
      { id:'transfer', label:'Transfer of remains', base:350, group:'transport', appliesTo:'both' },
      { id:'embalming', label:'Embalming', base:750, group:'funeral', appliesTo:'burial' },
      { id:'viewing', label:'Viewing or visitation', base:450, group:'ceremony', appliesTo:'both' },
      { id:'ceremony', label:'Funeral ceremony', base:500, group:'ceremony', appliesTo:'both' },
      { id:'hearse', label:'Hearse', base:350, group:'transport', appliesTo:'burial' },
      { id:'service_car', label:'Service car or van', base:150, group:'transport', appliesTo:'both' },
      { id:'metal_casket', label:'Metal casket', base:2500, group:'burial', appliesTo:'burial' },
      { id:'vault', label:'Vault', base:1500, group:'burial', appliesTo:'burial', isCemetery:true },
      { id:'plot', label:'Cemetery plot', base:2000, group:'burial', appliesTo:'both', isCemetery:true },
      { id:'opening', label:'Opening and closing grave', base:1200, group:'burial', appliesTo:'both', isCemetery:true },
      { id:'headstone', label:'Headstone or marker', base:2000, group:'burial', appliesTo:'both', isCemetery:true },
      { id:'cremation_fee', label:'Cremation fee', base:350, group:'cremation', appliesTo:'cremation' },
      { id:'urn', label:'Urn', base:250, group:'cremation', appliesTo:'cremation' }
    ];

    // App state
    let scenario = 'burial';
    let cemeteryOn = true;
    let multiplier = 1.0;
    const itemState = new Map();

    function initDefaults(){
      itemState.clear();
      ITEMS.forEach(it => itemState.set(it.id, { enabled: appliesNow(it) && cemeteryOK(it), amount: it.base }));
    }
    function appliesNow(it){ return it.appliesTo === 'both' || it.appliesTo === scenario; }
    function cemeteryOK(it){ return it.isCemetery ? cemeteryOn : true; }
    function fmtUSD(n){ return Number(n).toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0}); }

    // DOM
    const subtotalEl = document.getElementById('subtotal');
    const grandEl = document.getElementById('grand');
    const multiplierEl = document.getElementById('multiplier');
    const scenarioBadge = document.getElementById('scenarioBadge');
    const controlsSection = document.getElementById('controlsSection');
    const itemsSection = document.getElementById('itemsSection');
    const btnShowItems = document.getElementById('btnShowItems');
    const btnShowOptions = document.getElementById('btnShowOptions');
    const btnBurial = document.getElementById('btn-burial');
    const btnCremation = document.getElementById('btn-cremation');
    const btnCemOn = document.getElementById('btn-cemetery-on');
    const btnCemOff = document.getElementById('btn-cemetery-off');
    const stateSelect = document.getElementById('stateSelect');

    const bodies = {
      funeral: document.getElementById('bodyFuneral'),
      transport: document.getElementById('bodyTransport'),
      ceremony: document.getElementById('bodyCeremony'),
      burial: document.getElementById('bodyBurial'),
      cremation: document.getElementById('bodyCremation'),
    };

    function renderStates(){
      ALL_STATES.forEach(st => {
        const opt = document.createElement('option');
        const mult = STATE_MULTIPLIERS[st] || 1.0;
        opt.value = st;
        opt.textContent = `${st} (${mult === 1 ? 'avg' : mult === 1.2 ? 'higher' : 'lower'})`;
        stateSelect.appendChild(opt);
      });
      stateSelect.value = 'Utah';
      applyStateMultiplier();
    }
    function applyStateMultiplier(){
      multiplier = STATE_MULTIPLIERS[stateSelect.value] || 1.0;
      multiplierEl.textContent = '×' + multiplier.toFixed(2);
      updateTotals();
    }

    function renderItems(){
      Object.values(bodies).forEach(el => el.innerHTML='');
      ITEMS.forEach(item => {
        if(!appliesNow(item)) return;
        if(item.isCemetery && !cemeteryOn) return;
        const st = itemState.get(item.id);

        const tdName = document.createElement('td');
        tdName.textContent = item.label;

        const tdAmt = document.createElement('td');
        tdAmt.className='right';
        const view = document.createElement('span'); view.className='amount-view'; view.textContent = fmtUSD(st.amount);
        const editWrap = document.createElement('span'); editWrap.className='amount-edit';
        const input = document.createElement('input'); input.type='number'; input.min='0'; input.step='50'; input.value=st.amount; input.className='amount-input';
        const save = document.createElement('button'); save.className='link'; save.textContent='Save';
        const cancel = document.createElement('button'); cancel.className='link'; cancel.textContent='Cancel';
        editWrap.appendChild(input); editWrap.appendChild(document.createTextNode(' ')); editWrap.appendChild(save); editWrap.appendChild(document.createTextNode(' ')); editWrap.appendChild(cancel);
        tdAmt.appendChild(view); tdAmt.appendChild(editWrap);

        const tdAct = document.createElement('td'); tdAct.className='right';
        const actions = document.createElement('div'); actions.className='row-actions';
        const toggle = document.createElement('button'); toggle.className='link'; toggle.textContent = st.enabled ? 'Remove' : 'Add back';
        const edit = document.createElement('button'); edit.className='link'; edit.textContent='Edit amount';
        actions.appendChild(toggle); actions.appendChild(edit); tdAct.appendChild(actions);

        const tr = document.createElement('tr');
        if(!st.enabled) tr.classList.add('muted');
        tr.appendChild(tdName); tr.appendChild(tdAmt); tr.appendChild(tdAct);

        toggle.addEventListener('click', () => { st.enabled = !st.enabled; toggle.textContent = st.enabled ? 'Remove' : 'Add back'; tr.classList.toggle('muted', !st.enabled); updateTotals(); });
        edit.addEventListener('click', () => { view.style.display='none'; editWrap.style.display='inline'; input.focus(); });
        save.addEventListener('click', () => { st.amount = Number(input.value)||0; view.textContent = fmtUSD(st.amount); view.style.display='inline'; editWrap.style.display='none'; updateTotals(); });
        cancel.addEventListener('click', () => { input.value = st.amount; view.style.display='inline'; editWrap.style.display='none'; });

        bodies[item.group].appendChild(tr);
      });

      // Hide empty groups
      ['Funeral','Transport','Ceremony','Burial','Cremation'].forEach(name => {
        const section = document.getElementById('grp'+name);
        const body = document.getElementById('body'+name);
        section.style.display = body.children.length ? '' : 'none';
      });
    }

    function computeSubtotal(){
      let sum=0;
      ITEMS.forEach(it=>{
        const st=itemState.get(it.id);
        if(!st) return;
        if(!appliesNow(it)) return;
        if(it.isCemetery && !cemeteryOn) return;
        if(st.enabled) sum += Number(st.amount)||0;
      });
      return sum;
    }
    function updateTotals(){
      const sub = computeSubtotal();
      subtotalEl.textContent = fmtUSD(sub);
      grandEl.textContent = fmtUSD(sub*multiplier);
      scenarioBadge.textContent = `${scenario==='burial'?'Traditional burial':'Traditional cremation'}${cemeteryOn?', cemetery on':', cemetery off'}`;
    }

    function setScenario(next){
      scenario = next;
      document.getElementById('btn-burial').setAttribute('aria-pressed', scenario==='burial'?'true':'false');
      document.getElementById('btn-cremation').setAttribute('aria-pressed', scenario==='cremation'?'true':'false');
      ITEMS.forEach(it => { const st=itemState.get(it.id); st.enabled = appliesNow(it) && cemeteryOK(it); });
      renderItems(); updateTotals();
    }
    function setCemetery(on){
      cemeteryOn = on;
      document.getElementById('btn-cemetery-on').setAttribute('aria-pressed', on?'true':'false');
      document.getElementById('btn-cemetery-off').setAttribute('aria-pressed', on?'false':'true');
      ITEMS.forEach(it => { if(it.isCemetery){ const st=itemState.get(it.id); st.enabled = on && appliesNow(it);} });
      renderItems(); updateTotals();
    }

    // Buttons
    btnShowItems.addEventListener('click', () => {
      controlsSection.style.display = '';
      itemsSection.style.display = '';
      // scroll into view
      setTimeout(() => itemsSection.scrollIntoView({behavior:'smooth', block:'start'}), 50);
    });
    btnShowOptions.addEventListener('click', () => {
      controlsSection.style.display = '';
      setTimeout(() => controlsSection.scrollIntoView({behavior:'smooth', block:'start'}), 50);
    });
    btnBurial.addEventListener('click', () => setScenario('burial'));
    btnCremation.addEventListener('click', () => setScenario('cremation'));
    btnCemOn.addEventListener('click', () => setCemetery(true));
    btnCemOff.addEventListener('click', () => setCemetery(false));
    stateSelect.addEventListener('change', applyStateMultiplier);
    document.getElementById('btnPrint').addEventListener('click', () => window.print());
    document.getElementById('btnCSV').addEventListener('click', () => {
      const rows = [['Item','Amount (USD)','Included']];
      ITEMS.forEach(it => {
        const st = itemState.get(it.id);
        if(!appliesNow(it)) return;
        if(it.isCemetery && !cemeteryOn) return;
        rows.push([it.label, (Number(st.amount)||0).toFixed(0), st.enabled ? 'Yes':'No']);
      });
      rows.push(['Subtotal', computeSubtotal().toFixed(0), '']);
      rows.push(['State multiplier', multiplier.toFixed(2), '']);
      rows.push(['Total', (computeSubtotal()*multiplier).toFixed(0), '']);
      const csv = rows.map(r => r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='quietpath-funeral-estimate.csv'; a.click(); URL.revokeObjectURL(url);
    });

    function boot(){
      initDefaults(); renderStates(); renderItems(); updateTotals();

      // If URL has #details or ?details=1, open sections automatically
      if(location.hash === '#details' || /[?&]details=1/.test(location.search)){
        controlsSection.style.display=''; itemsSection.style.display='';
      }
    }
    boot();
  </script>
</body>
</html>
